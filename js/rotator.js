(function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};null==this.Fontana&&(this.Fontana={}),null==(a=this.Fontana).datasources&&(a.datasources={}),this.Fontana.datasources.Static=function(){function a(a){this.messages=null!=a?a:[]}return a.prototype.setMessages=function(a){return null==this.messages&&(this.messages=[]),this.mesages=a.concat(this.mesages)},a.prototype.getMessages=function(a){var b=this;return a?setTimeout(function(){return a(b.messages)},0):void 0},a}(),this.Fontana.datasources.HTML=function(){function a(a){this.container=a,this.messages=[]}return a.prototype.extractMessages=function(){var a;return a=[],$(".message",this.container).each(function(b,c){return a.push({id:c.id,created_at:(new Date).toString(),text:$(".text",c).text(),user:{name:$(".name",c).text(),screen_name:$(".screen_name",c).text().replace(/^@/,""),profile_image_url:$(".avatar",c).attr("src")}})}),a},a.prototype.getMessages=function(a){var c,d,e,f=this;return c=[function(){var a,b,c,e;for(c=this.messages,e=[],a=0,b=c.length;b>a;a++)d=c[a],e.push(d.id);return e}.call(this)],e=[],this.extractMessages().forEach(function(a){var d;return d=a.id,b.call(c,d)<0?e.push(a):void 0}),this.messages=e.concat(this.messages),a?setTimeout(function(){return a(f.messages)},0):void 0},a}(),this.Fontana.datasources.TwitterSearch=function(){function a(a){this.q=a,this.params={since_id:1,q:this.q},this.lastCall=0,this.messages=[]}var b;return b=5e3,a.prototype.getMessages=function(a){var c,d=this;return c=(new Date).getTime(),c-this.lastCall<b?a?setTimeout(function(){return a(d.messages)},0):void 0:(this.lastCall=(new Date).getTime(),$.getJSON("/api/twitter/search/",this.params).success(function(b){return b.statuses.length&&(d.messages=b.statuses.concat(d.messages),d.params.since_id=d.messages[0].id_str),a?d.messages.length?a(d.messages):a([{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Your search term returned no Tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}).error(function(){return a?a([{id:(new Date).getTime(),created_at:(new Date).toString(),text:"Error fetching tweets :(",user:{name:"Twitter Fontana",screen_name:"twitterfontana",profile_image_url:"/img/avatar.png"}}]):void 0}))},a}()}).call(this),function(){var a,b,c;null==this.Fontana&&(this.Fontana={}),null==(c=this.Fontana).utils&&(c.utils={}),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.Fontana.utils.prettyDate=function(b){var c,d,e,f;return c=new Date(b),f=(new Date).getTime(),e=(f-c.getTime())/1e3,d=Math.floor(e/86400),isNaN(c)?b:isNaN(d)||0>d||d>=1?365>=d?""+c.getDate()+" "+a[c.getMonth()]:""+c.getDate()+" "+a[c.getMonth()]+" "+c.getFullYear():!d&&10>e?"just now":!d&&60>e?""+Math.floor(e)+"s":!d&&3600>e?""+Math.floor(e/60)+"m":!d&&86400>e?""+Math.floor(e/3600)+"h":void 0},b=["webkit","moz","ms"],this.Fontana.utils.requestFullScreen=function(a){var c;return c=a.requestFullscreen||a.requestFullScreen,b.some(function(b){return null==c&&(c=a[b+"RequestFullScreen"]),!!c}),c?c.call(a,Element.ALLOW_KEYBOARD_INPUT):void 0},this.Fontana.utils.cancelFullScreen=function(){var a;return a=document.exitFullscreen||document.cancelFullScreen,b.some(function(b){return null==a&&(a=document[b+"CancelFullScreen"]),!!a}),a?a.call(document):void 0},this.Fontana.utils.isFullScreen=function(){var a;return a=document.fullScreen||document.isFullScreen,b.some(function(b){return null==a&&(a=document[b+"FullScreen"]||document[b+"IsFullScreen"]),!!a}),!!a}}.call(this),function(){var a,b;null==this.Fontana&&(this.Fontana={}),a='<div id="{id}" class="message media well col-md-6 col-md-offset-3">    <figure class="pull-left media-object">        <img src="{user.profile_image_url}" width="64" height="64" alt="" class="avatar img-thumbnail">    </figure>    <div class="media-body">        <div class="media-heading">            <cite>                <span class="name">{user.name}</span>                <small class="text-muted">                    <span class="screen_name">@{user.screen_name}</span>                    <time class="time pull-right" data-time="{created_at}">{created_at}</time>                </small>            </cite>        </div>        <div class="text lead"><q>{text}</q></div>    </div></div>',b=["compress","fade-in","hinge","lightspeed","scroll-up","scroll-down","slide","tilt-scroll","vertigo","zoom-in"],Fontana.Visualizer=function(){function c(a,b){this.container=a,this.datasource=b,this.paused=!1,this.fetchMessagesTimer=-1,this.animationTimer=-1}return c.prototype.start=function(a){return this.fetchMessages(!0),this.container.empty(),this.config(a),this.scheduleUpdateAllTimes()},c.prototype.config=function(a){var c=this;return b.forEach(function(a){return c.container.removeClass(a)}),a&&a.transition&&b.indexOf(a.transition)>-1?this.container.addClass(a.transition):this.container.addClass(b[0])},c.prototype.pause=function(){return this.paused?void 0:(clearTimeout(this.fetchMessagesTimer),clearTimeout(this.animationTimer),this.paused=!0)},c.prototype.resume=function(){return this.paused?(this.fetchMessages(),this.animate(),this.paused=!1):void 0},c.prototype.stop=function(){return this.pause(),this.container.empty()},c.prototype.fetchMessages=function(a){var b=this;return null==a&&(a=!1),this.datasource.getMessages(function(c){return b.renderMessages(c,a),b.scheduleFetchMessages()})},c.prototype.renderMessages=function(b,c){var d=this;return null==c&&(c=!1),b.reverse().forEach(function(b){var c;return $("#"+b.id).length?void 0:(b.text=b.entities?twttr.txt.autoLinkWithJSON(b.text,b.entities,{targetBlank:!0}):twttr.txt.autoLink(b.text,{targetBlank:!0}),c=$(nano(a,b)),d.updateTime(c),d.container.prepend(c))}),c?this.scheduleAnimation():void 0},c.prototype.animate=function(){var a,b,c;return a=$(".message",this.container),a.removeClass("next next-one focus prev-one prev "),this.current=this.current?this.current.next().length?this.current.next():$(".message:first",this.container):$(".message:first",this.container),b=this.current.next(),b.length||(b=$(".message:first",this.container)),this.current.addClass("focus"),b.addClass("next-one"),b.nextAll(":not(.focus)").addClass("next"),c=this.current.prev(),c.length||(c=$(".message:last",this.container)),c.addClass("prev-one").removeClass("next"),c.prevAll(":not(.next-one):not(.next):not(.focus)").addClass("prev"),this.scheduleAnimation()},c.prototype.updateAllTimes=function(){var a=this;return $(".message",this.container).each(function(b,c){return a.updateTime(c)}),this.scheduleUpdateAllTimes()},c.prototype.updateTime=function(a){var b;return b=$(".time",a),b.text(Fontana.utils.prettyDate(b.data("time")))},c.prototype.scheduleAnimation=function(){var a,b=this;return a=-1===this.animationTimer?0:6e3,this.animationTimer=setTimeout(function(){return b.animate()},a)},c.prototype.scheduleFetchMessages=function(){var a=this;return this.fetchMessagesTimer=setTimeout(function(){return a.fetchMessages()},3e4)},c.prototype.scheduleUpdateAllTimes=function(){var a=this;return setTimeout(function(){return a.updateAllTimes()},1e4)},c}(),this.Fontana.Visualizer.transitionEffects=b}.call(this);
